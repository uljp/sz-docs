(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{308:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://deno.land/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Deno"),s("OutboundLink")],1),t._v("简单说是Node.js的替代品，是Node.js之父Ryan Dahl 为挽回Node.js的错误而开发的。")]),t._v(" "),s("p",[t._v("Node.js存在的问题有：")]),t._v(" "),s("ol",[s("li",[t._v("npm包管理（node_modules）复杂。")]),t._v(" "),s("li",[t._v("历史原因导致的api维护，比如早期变态的callback设置。")]),t._v(" "),s("li",[t._v("没有安全措施，用户只要下载了外部模块，就只好听任别人的代码在本地运行，进行各种读写操作。")]),t._v(" "),s("li",[t._v("功能不完善，导致各种工具层出不穷，比如webpack、babel等。")])]),t._v(" "),s("p",[t._v("由于上面这些原因，Ryan Dahl 决定放弃 Node.js，从头写一个替代品，彻底解决这些问题。"),s("br"),t._v('\ndeno 这个名字就是来自 Node 的字母重新组合（Node = no + de），表示"拆除 Node.js"（de = destroy, no = Node.js）。')]),t._v(" "),s("p",[t._v("跟 Node.js一样，Deno 也是一个服务器运行时，但是支持多种语言，可以直接运行 "),s("strong",[t._v("JavaScript、TypeScript 和 WebAssembly")]),t._v(" 程序。")]),t._v(" "),s("ul",[s("li",[t._v("它内置了 V8 引擎，用来解释 JavaScript。同时，也内置了 tsc 引擎，解释 TypeScript。")]),t._v(" "),s("li",[t._v("它使用 Rust 语言开发，由于 Rust 原生支持 WebAssembly，所以它也能直接运行 WebAssembly。")]),t._v(" "),s("li",[t._v("它的异步操作不使用 libuv 这个库，而是使用 Rust 语言的 Tokio 库，来实现事件循环（event loop）。")])]),t._v(" "),s("p",[t._v("它的架构如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pan.udolphin.com/files/image/2021/9/106325a108b0f81ebf4e6ba29bc51031.jpg",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("说明："),s("br"),t._v("\n1、Rust 是由 Mozilla 主导开发的通用、编译型编程语言。设计准则为 “安全、并发、实用”，支持函数式、并发式、过程式以及面向对象的编程风格。Deno 使用 Rust 语言来封装 V8 引擎，通过 libdeno 绑定，我们就可以在 JavaScript 中调用隔离的功能。"),s("br"),t._v("\n2、Tokio 是 Rust 编程语言的异步运行时，提供异步事件驱动平台，构建快速，可靠和轻量级网络应用。利用 Rust 的所有权和并发模型确保线程安全。Tokio 构建于 Rust 之上，提供极快的性能，使其成为高性能服务器应用程序的理想选择。在 Deno 中 Tokio 用于并行执行所有的异步 IO 任务。"),s("br"),t._v("\n3、V8 是一个由 Google 开发的开源 JavaScript 引擎，用于 Google Chrome 及 Chromium 中。V8 在运行之前将JavaScript 编译成了机器代码，而非字节码或是解释执行它，以此提升性能。更进一步，使用了如内联缓存（inline caching）等方法来提高性能。有了这些功能，JavaScript 程序与 V8 引擎的速度媲美二进制编译。在 Deno 中，V8 引擎用于执行 JavaScript 代码。"),s("br"),t._v("\n4、Deno与Node.js的核心模型是一致的，都是异步非阻塞I/O。所以Deno与Node.js在使用场景上基本一致，适合I/O密集型，不适用于CPU密集型。开发中要避免使用同步I/O和复杂计算场景。")])]),t._v(" "),s("h3",{attrs:{id:"优势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优势"}},[t._v("#")]),t._v(" 优势")]),t._v(" "),s("p",[t._v("Deno凭什么来吸引开发者改换门庭，转投它的怀抱呢？于我而言，主要有以下几点：")]),t._v(" "),s("ul",[s("li",[t._v("天然支持ts。如果用Node.js，需要我们手动将ts编译成js，或者使用ts-node这种第三方工具。Deno不需要配置，开箱即用。")]),t._v(" "),s("li",[t._v("内存安全。相较于Node.js，它的性能优势并不明显，因为就是js换了个运行环境而已，Rust并不见得比C++更高效，不过Rust会天然让它的内存安全和核心代码的健壮性更有保障些。")]),t._v(" "),s("li",[t._v("安全机制。除非明确启用，否则没有文件，网络或环境访问权限。对于运行权限的划分，能清晰知道你的程序需要拥有哪些权限，对网络资源没有信任的同学可以放心了。")]),t._v(" "),s("li",[t._v("没有历史包袱。不像Node.js一开始自定义了commonjs规范，Deno直接支持ES Modules。没有回调地狱，代码结构更清晰，利于tree shaking；也可以直接使用"),s("mark",[t._v("顶级")]),t._v("await。")]),t._v(" "),s("li",[t._v("去中心化。不用每个工程都安装一大堆node_modules，有个线上的url就能获取代码。")]),t._v(" "),s("li",[t._v("内置浏览器API。Deno实现了fetch、FormData、WebSocket等浏览器的API，虽然被某些开发者诟病，但对前端开发者而言是真的友好，比如进行接口调用，与在浏览器里使用几乎没有区别。")]),t._v(" "),s("li",[t._v("全家桶似的服务，比如打包、格式化、代码校验，可以让你更专注业务，而不是成为某工具的配置工程师。")])]),t._v(" "),s("p",[t._v("​")]),t._v(" "),s("h3",{attrs:{id:"缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),s("p",[t._v("Deno的缺点也很明显：")]),t._v(" "),s("ul",[s("li",[t._v("没有针对Node.js压倒性的性能优势，所以对以上优势不感兴趣的开发者而言，就没有吸引力了。")])]),t._v(" "),s("blockquote",[s("p",[t._v("Deno 是一个合适的异步服务器，每秒 25k 请求足以满足大多数目的，此外，由于普遍使用 Promise，Deno 有更好的尾部延迟。目前 Deno HTTP 服务器每秒处理约 25 000 个请求，"),s("mark",[t._v("最大")]),t._v("延迟为 1.3 毫秒，与之相比，Node 程序每秒处理 34 000 个请求，"),s("mark",[t._v("最大")]),t._v("延迟介于 2 到 300 毫秒之间。"),s("br"),t._v("\n可以看出，Deno的优势在于延迟低，但并没有压倒性优势。")])]),t._v(" "),s("ul",[s("li",[t._v("无法完全继承Node.js的生态。虽然Deno提供了几款CDN服务，可以将旧的npm包转换为Deno可使用的格式，但并非所有npm包都能转换成功。因为Node.js仍有部分API官方没有实现，如果某个偏底层的包转换失败，所有依赖它的包都无法成功。所以，你很有可能在开发的某个环节需要造轮子。当然，这对于喜欢钻研技术的同学而言反而是个利好。")]),t._v(" "),s("li",[t._v("去中心化后，国内就没有办法像npm做镜像，官方搭建deno.land来存储github上各种资源，但目前只支持github上私有资源。想要引用私有文件，就必须自己搭建服务器，在CICD中构建的话，又有额外的技术难点需要解决。")])]),t._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("p",[t._v("1、 Mac/Linux")]),t._v(" "),s("p",[t._v("执行以下命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-fsSL")]),t._v(" https://deno.land/x/install/install.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n")])])]),s("p",[t._v("2、Windows")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("https://github.com/denoland/deno/releases\n")])])]),s("p",[t._v("直接在这里下载exe文件吧。"),s("br"),t._v("\n​")]),t._v(" "),s("p",[t._v("当然，Mac与Linux也可以这样安装，但"),s("mark",[t._v("新版本")]),t._v("的Mac系统可能会因为安全权限而禁止程序使用，需要参考"),s("a",{attrs:{href:"https://support.apple.com/zh-cn/HT202491",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1),t._v("配置下。")]),t._v(" "),s("h3",{attrs:{id:"设置环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置环境变量"}},[t._v("#")]),t._v(" 设置环境变量")]),t._v(" "),s("p",[t._v("关键要设置两个环境变量，一是deno二进制文件的目录，二是使用deno安装的全局命令的目录。"),s("br"),t._v("\n以下是Linux命令行操作：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("echo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'export DENO_INSTALL="$HOME/.deno"\nexport PATH="$DENO_INSTALL/bin:$PATH"\nexport DENO_DIR=$HOME/.deno\n\'')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" ~/.bash_profile\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" ~/.bash_profile\n")])])]),s("p",[t._v("Mac环境，修改文件推荐使用"),s("code",[t._v(".zshrc")]),t._v("。如果是使用命令安装的，注意看有提示信息。")]),t._v(" "),s("p",[t._v("而windows环境，我的电脑 -> 属性 -> 高级系统设置 -> 高级 -> 环境变量设置，上面用户变量和系统变量都可以配置。")]),t._v(" "),s("p",[t._v("比如把下载的deno.exe放在C:/bin目录下，在path的环境变量里添加一条C:\\bin。另一个环境变量就是 DENO_INSTALL了，与Linux一样，通常是$HOME/.deno，比如我的是C:\\Users\\Administrator.deno，把它的bin目录添加到path中。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pan.udolphin.com/files/image/2022/7/10c4ae1fc0214bb2748476ef85877946.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--version")]),t._v("\n")])])]),s("p",[t._v("如果没有生效，有时候需要重启电脑，尤其是windows。")]),t._v(" "),s("h3",{attrs:{id:"升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级"}},[t._v("#")]),t._v(" 升级")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("deno upgrade\n")])])]),s("p",[t._v("或升级到特定版本，例如"),s("code",[t._v("v1.3.0")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno upgrade "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--version")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.3")]),t._v(".0\n")])])]),s("h2",{attrs:{id:"安全机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全机制"}},[t._v("#")]),t._v(" 安全机制")]),t._v(" "),s("p",[t._v("Deno 具有安全控制，默认情况下脚本不具有读写权限。如果脚本未授权，就读写文件系统或网络，会报错。")]),t._v(" "),s("p",[t._v("必须使用参数，显式打开权限才可以。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("--allow-read：打开读权限，可以指定可读的目录，比如--allow-read"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/temp。\n--allow-write：打开写权限。\n--allow-net"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("google.com：允许网络通信，可以指定可请求的域，比如--allow-net"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("google.com。\n--allow-env：允许读取环境变量。\n--allow-run：允许运行子进程。\n")])])]),s("p",[t._v("要使用不稳定的新特性，需要这样：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unstable")]),t._v("\n")])])]),s("p",[t._v("还有新加的"),s("code",[t._v("--allow-ffi")]),t._v(" 和"),s("code",[t._v("--allow-hrtime")]),t._v("，一般用不到，这里不再赘述，请情参考"),s("a",{attrs:{href:"https://deno.land/manual@v1.13.2/getting_started/permissions",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),s("p",[t._v("使用deno run来运行程序，当然，一般需要加上上面的安全机制。"),s("br"),t._v("\n如果你的程序什么权限都没使用，只是下面这种：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("那么直接用"),s("strong",[t._v("deno run main.ts")]),t._v("就可以了。"),s("br"),t._v("\n注意，我们推荐使用ts，但也可以运行js。"),s("br"),t._v("\n​")]),t._v(" "),s("p",[t._v("如果需要读取文件，比如")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" decoder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextDecoder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"utf-8"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" Deno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("decoder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("自然得这样："),s("strong",[t._v("deno run --allow-read main.ts")]),s("br"),t._v(" "),s("strong",[t._v("​")])]),t._v(" "),s("p",[t._v("如果需要网络，比如开启一个tcp：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * echo_server.ts\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" copy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://deno.land/std@0.106.0/io/util.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" listener "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Deno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"listening on 0.0.0.0:8080"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" conn "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" listener"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("finally")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("你必须："),s("strong",[t._v("deno run --allow-net main.ts")])]),t._v(" "),s("p",[t._v("如果懒得管理权限，则使用"),s("code",[t._v("-A")]),t._v("（"),s("code",[t._v("deno run -A main.ts")]),t._v("），那就后果自负了。")]),t._v(" "),s("p",[t._v("当然，也可以运行远程服务器上的文件，比如官方的"),s("code",[t._v("hello world")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno run https://deno.land/std/examples/welcome.ts\n")])])]),s("h2",{attrs:{id:"更新模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新模块"}},[t._v("#")]),t._v(" 更新模块")]),t._v(" "),s("p",[t._v("默认代码中引用中的ts或js文件，会缓存到本地。如果你引用的文件url中没有带版本号，那么就是"),s("mark",[t._v("最新")]),t._v("版的代码。这时，你想要更新代码，那么你需要这样操作：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno cache "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v(" my_module.ts\n")])])]),s("p",[t._v("更新线上与本地文件：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno cache "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://deno.land/std@0.106.0 my_module.ts\n")])])]),s("p",[t._v("更新线上某个文件与某文件夹：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno cache "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https://deno.land/std@0.106.0/fs/copy.ts,https://deno.land/std@0.106\n")])])]),s("h2",{attrs:{id:"锁定文件校验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#锁定文件校验"}},[t._v("#")]),t._v(" 锁定文件校验")]),t._v(" "),s("p",[t._v("如果你在开发一个底层库或框架供他人使用，那么推荐创建一个"),s("code",[t._v("deps.ts")]),t._v("文件，来管理外部引用的文件。其实就是起到类似"),s("code",[t._v("package-lock.json")]),t._v("的作用，管理引用的文件与版本。")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// deps.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" xyz "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://unpkg.com/xyz-lib@v0.9.0/lib.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("​")]),t._v(" "),s("p",[t._v("然后用"),s("code",[t._v("deno cache")]),t._v(" 生成一个"),s("code",[t._v("lock.json")]),t._v("文件：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Create/update the lock file "deno.lock".')]),t._v("\ndeno cache "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--lock")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("deno.lock --lock-write deps.ts\n")])])]),s("p",[t._v("另一台机器克隆下代码，运行后：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Download the project's dependencies into the machine's cache, integrity")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# checking each resource.")]),t._v("\ndeno cache "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--lock")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("deno.lock deps.ts\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Done! You can proceed safely.")]),t._v("\ndeno "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" --allow-read src\n")])])]),s("h2",{attrs:{id:"导入地图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入地图"}},[t._v("#")]),t._v(" 导入地图")]),t._v(" "),s("p",[t._v("可以使用带有"),s("code",[t._v("--import-map=<FILE>CLI")]),t._v(" 标志的导入映射，这样开发时使用体验类似于Node.js了。")]),t._v(" "),s("blockquote",[s("p",[t._v("不过如果是发布给别人使用的模块，不建议用它，因为这需要别人也把你的map文件复制过来。")])]),t._v(" "),s("p",[t._v("例：import_map.json")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"imports"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      \n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fmt/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://deno.land/std@0.106.0/fmt/"')]),t._v("   \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("main.ts:")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" red "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt/colors.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("red")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("然后：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno run --import-map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("import_map.json main.ts\n")])])]),s("p",[t._v("建议在上层应用开发时，所有的第三方引用都在import_map.json里维护，这样好管理依赖的版本。")]),t._v(" "),s("h2",{attrs:{id:"来自cdn的包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#来自cdn的包"}},[t._v("#")]),t._v(" 来自CDN的包")]),t._v(" "),s("p",[t._v("目前，推荐将共享的代码发布在官方搭建的平台"),s("a",{attrs:{href:"https://deno.land/x/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://deno.land/x/"),s("OutboundLink")],1),t._v("上，它的发布也很简单，在你的github仓库里配置一个web hook，就可以了。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pan.udolphin.com/files/image/2021/9/60d4209186c70101d3e7628b476ddc89.png",alt:""}})]),t._v(" "),s("p",[t._v("具体详见引导，非常简单，这里不再赘述。"),s("br"),t._v("\n​")]),t._v(" "),s("h3",{attrs:{id:"esm-sh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#esm-sh"}},[t._v("#")]),t._v(" esm.sh")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://esm.sh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://esm.sh/"),s("OutboundLink")],1),t._v("是个转换npm包为Deno使用的线上地址，它使用esbuild进行转换，速度很快。比如我们要使用React，可以这样直接使用：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://esm.sh/react"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("当然也支持版本号：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://esm.sh/react@17.0.2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"skypack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#skypack"}},[t._v("#")]),t._v(" Skypack")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.skypack.dev/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.skypack.dev/"),s("OutboundLink")],1),t._v("也是类似：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://cdn.skypack.dev/react"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"直接使用npm包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#直接使用npm包"}},[t._v("#")]),t._v(" 直接使用npm包")]),t._v(" "),s("p",[t._v("Deno从1.28版本起，可以这样直接利用npm的包：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" chalk "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm:chalk@5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chalk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("green")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("引用规则：")]),t._v(" "),s("p",[s("code",[t._v("npm:<package-name>[@<version-requirement>][/<sub-path>]")])]),t._v(" "),s("p",[t._v("以下是另一个样例：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// @deno-types="npm:@types/express@^4.17"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" express "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm:express@^4.17"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"listening on http://localhost:3000/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("如果在国内下载npm的网速较慢，可以使用环境变量"),s("code",[t._v("NPM_CONFIG_REGISTRY")]),t._v("来设置npm的镜像：")]),t._v(" "),s("p",[s("code",[t._v("NPM_CONFIG_REGISTRY=https://registry.npmmirror.com/ deno run -A main.ts")])]),t._v(" "),s("h2",{attrs:{id:"安装脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装脚本"}},[t._v("#")]),t._v(" 安装脚本")]),t._v(" "),s("p",[t._v("使用deno install可以方便地安装一个脚本，类似于"),s("code",[t._v("npm i -g xxx")]),t._v("模块。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ deno "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --allow-net --allow-read https://deno.land/std@0.106.0/http/file_server.ts\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Compiling https://deno.land/std@0.106.0/http/file_server.ts\n\n✅ Successfully installed file_server.\n/Users/deno/.deno/bin/file_server\n")])])]),s("p",[t._v("之后就能使用file_server命令了。当然，需要将打印信息里这个bin目录添加到环境变量里，前文提过，这里不再赘述。")]),t._v(" "),s("h2",{attrs:{id:"打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[t._v("#")]),t._v(" 打包")]),t._v(" "),s("h3",{attrs:{id:"打包为js"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包为js"}},[t._v("#")]),t._v(" 打包为js")]),t._v(" "),s("p",[t._v("可以打包线上或本地文件为一个js文件：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno bundle https://deno.land/std@0.106.0/examples/colors.ts colors.bundle.js\ndeno bundle main.ts main.js\n")])])]),s("p",[t._v("打包后的文件是可以运行的：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-A")]),t._v(" bundle.js\n")])])]),s("p",[t._v("因为导出的是个ES模块化的代码，甚至可以放到浏览器里使用：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("website.bundle.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("或者在另一个js里引用：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" website "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"website.bundle.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"编译为可执行文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译为可执行文件"}},[t._v("#")]),t._v(" 编译为可执行文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("deno compile https://deno.land/std/examples/welcome.ts\n")])])]),s("p",[t._v("也可以通过添加"),s("code",[t._v("--targetCLI")]),t._v("标志为其他平台编译二进制文件，比如在linux服务器上打包一个exe文件供windows使用。详见"),s("a",{attrs:{href:"https://deno.land/manual@v1.13.2/tools/compiler",target:"_blank",rel:"noopener noreferrer"}},[t._v("此处"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"生成文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成文档"}},[t._v("#")]),t._v(" 生成文档")]),t._v(" "),s("p",[s("strong",[t._v("deno doc")]),t._v("后跟一个或多个源文件的列表将打印每个模块导出成员的 JSDoc 文档。"),s("br"),t._v("\n例如，给定一个add.ts包含以下内容的文件：")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Adds x and y.\n * @param {number} x\n * @param {number} y\n * @returns {number} Sum of x and y\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("运行 deno doc命令，将函数的 JSDoc 注释打印到stdout。")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("--json")]),t._v("标志以 JSON 格式输出文档。这种 JSON 格式由 "),s("a",{attrs:{href:"https://github.com/denoland/doc_website",target:"_blank",rel:"noopener noreferrer"}},[t._v("deno doc 网站"),s("OutboundLink")],1),t._v("使用，用于生成模块文档。")]),t._v(" "),s("h2",{attrs:{id:"任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#任务"}},[t._v("#")]),t._v(" 任务")]),t._v(" "),s("p",[t._v("项目根目录下新建一个deno.json或deno.jsonc文件，内容如下：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"tasks"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"dev"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deno run -A main.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后就可以使用"),s("code",[t._v("deno task dev")]),t._v("来运行命令。")]),t._v(" "),s("p",[t._v("其实就是Node.js的Package.json中script标签的替代品。")]),t._v(" "),s("h2",{attrs:{id:"代码风格"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码风格"}},[t._v("#")]),t._v(" 代码风格")]),t._v(" "),s("h3",{attrs:{id:"格式化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#格式化"}},[t._v("#")]),t._v(" 格式化")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("deno fmt")]),t._v("。它会将代码格式化为官方推荐的样子，其实起到的类似"),s("code",[t._v("eslint --fix")]),t._v("的效果。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# format all JS/TS files in the current directory and subdirectories")]),t._v("\ndeno "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fmt")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# format specific files")]),t._v("\ndeno "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fmt")]),t._v(" myfile1.ts myfile2.ts\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# check if all the JS/TS files in the current directory and subdirectories are formatted")]),t._v("\ndeno "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fmt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--check")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# format stdin and write to stdout")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" file.ts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" deno "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fmt")]),t._v(" -\n")])])]),s("h3",{attrs:{id:"代码校验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码校验"}},[t._v("#")]),t._v(" 代码校验")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("deno lint")]),t._v("。有了它，就不必再使用"),s("code",[t._v("eslint")]),t._v("了。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lint all JS/TS files in the current directory and subdirectories")]),t._v("\ndeno lint\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# lint specific files")]),t._v("\ndeno lint myfile1.ts myfile2.ts\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print result as JSON")]),t._v("\ndeno lint "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--json")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# read from stdin")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" file.ts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" deno lint -\n")])])]),s("h3",{attrs:{id:"编码风格指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编码风格指南"}},[t._v("#")]),t._v(" 编码风格指南")]),t._v(" "),s("p",[t._v("参见"),s("a",{attrs:{href:"https://deno.land/manual@v1.13.2/contributing/style_guide",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方指南"),s("OutboundLink")],1),t._v("，举几条对我们有用的：")]),t._v(" "),s("ul",[s("li",[t._v("使用 TypeScript 而不是 JavaScript")]),t._v(" "),s("li",[t._v("在文件名中使用下划线，而不是破折号")]),t._v(" "),s("li",[t._v("不要使用文件名index.ts/ index.js。入口文件使用mod.ts/mod.js")]),t._v(" "),s("li",[t._v("导出的函数：最多 2 个参数，将其余的放入选项对象中")]),t._v(" "),s("li",[s("mark",[t._v("顶级")]),t._v("函数不应使用箭头语法。"),s("mark",[t._v("顶级")]),t._v("函数应该使用function关键字。箭头语法应该仅限于闭包")])]),t._v(" "),s("h2",{attrs:{id:"调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调试"}},[t._v("#")]),t._v(" 调试")]),t._v(" "),s("p",[t._v("像Node.js一样，Deno程序也可以在chrome浏览器中调试，具体就不介绍了。"),s("br"),t._v("\n主要说下vscode中调试。")]),t._v(" "),s("p",[t._v("需要在项目根目录下配置"),s("code",[t._v(".vscode/launch.json")]),t._v("文件，内容大概如下：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.2.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"configurations"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Deno: Run"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"request"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"launch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pwa-node"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"program"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src/main.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 具体文件路径")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cwd"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${workspaceFolder}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"runtimeExecutable"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deno"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"runtimeArgs"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--unstable"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--inspect"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--allow-all"')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"attachSimplePort"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9229")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如果你的入口文件有多个，写起来比较麻烦，可以这样：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.2.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"configurations"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Deno"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pwa-node"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"request"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"launch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cwd"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${workspaceFolder}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"runtimeExecutable"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deno"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"runtimeArgs"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--inspect-brk"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-A"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--config"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tsconfig.json"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--unstable"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${file}"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"attachSimplePort"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9229")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("详情可以参考"),s("a",{attrs:{href:"https://deno.land/manual@v1.13.2/vscode_deno#using-the-debugger",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"各大主流库替代方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#各大主流库替代方案"}},[t._v("#")]),t._v(" 各大主流库替代方案")]),t._v(" "),s("h3",{attrs:{id:"electron"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#electron"}},[t._v("#")]),t._v(" Electron")]),t._v(" "),s("p",[t._v("我们知道，现在Electron是个优秀的桌面端解决方案，我们常用的vscode就是用它写的，基于Node.js + Chromium 的 Electron 来依托 Web 技术栈创建桌面应用程序。那么我们可以在 Deno 下使用 Electron 吗？或者还有其它更多选择吗？"),s("br"),t._v("\n答案是如今的 Electron 还远远不能运行在 Deno 上，我们必须寻找其它的解决方案。自从 Deno 选择用 Rust 语言构建其内核后，我们可以使用 Rust 生态上的 Web View "),s("a",{attrs:{href:"https://github.com/Boscop/web-view",target:"_blank",rel:"noopener noreferrer"}},[t._v("@Bosop/web-view"),s("OutboundLink")],1),t._v(" 来在 Deno 上运行桌面应用。"),s("br"),t._v("\n于是 "),s("a",{attrs:{href:"https://github.com/eliassjogreen/deno_webview",target:"_blank",rel:"noopener noreferrer"}},[t._v("@eliassjogreen/deno_webview"),s("OutboundLink")],1),t._v(" 应运而生。")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Webview "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://deno.land/x/webview/mod.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" html "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n  <html>\n  <body>\n    <h1>Hello from deno v")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("Deno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deno"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("</h1>\n  </body>\n  </html>\n")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" webview "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Webview")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("data:text/html,")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeURIComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" webview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"pm2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[t._v("#")]),t._v(" pm2")]),t._v(" "),s("p",[t._v("我们使用"),s("code",[t._v("pm2")]),t._v("来守护"),s("code",[t._v("Node.js")]),t._v("进程，可以让代码运行在后台。事实上，它也可以运行 "),s("code",[t._v("Node.js")]),t._v(" 之外的的脚本语言：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("pm2 start "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" deno_blog src/main.ts "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--interpreter")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'deno'")]),t._v(" --interpreter-args"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'run --allow-net --allow-run --allow-env --allow-write --allow-read --importmap import_map.json --unstable'")]),t._v("\n")])])]),s("h3",{attrs:{id:"express-koa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#express-koa"}},[t._v("#")]),t._v(" Express / koa")]),t._v(" "),s("p",[t._v("这俩Node.js祖师爷级别的web框架，在deno里当然少不了，Express不建议使用，推荐用koa的高仿"),s("a",{attrs:{href:"https://deno.land/x/oak",target:"_blank",rel:"noopener noreferrer"}},[t._v("oak"),s("OutboundLink")],1),t._v("吧。")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Application "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://deno.land/x/oak/mod.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"nestjs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nestjs"}},[t._v("#")]),t._v(" nestjs")]),t._v(" "),s("p",[s("code",[t._v("nestjs")]),t._v(" 是一个用于构建高效、可扩展的Node.js服务器端应用程序的开发框架。它利用 JavaScript 的渐进增强的能力，使用并完全支持 TypeScript（仍然允许开发者使用纯 JavaScript 进行开发），并结合了 OOP （面向对象编程）、FP （函数式编程）和 FRP （函数响应式编程）。从它身上，我们能看到Spring和Angular的影子。")]),t._v(" "),s("p",[t._v("我们可以利用"),s("code",[t._v("nestjs")]),t._v("轻松构建一个REST服务，以Controlller的用法为例：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("@Controller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cats'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" class CatsController "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  @Get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  findAll"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": string "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This action returns all cats'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("官方目前并没有打算做deno的版本，所以我基于oak实现了一个简版的"),s("a",{attrs:{href:"https://deno.land/x/oak_nest",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("oak_nest")]),s("OutboundLink")],1),t._v("，包括Controller、安全守卫和各类参数装饰器。感兴趣的同学可以试用，有问题随时可以找我。")]),t._v(" "),s("h3",{attrs:{id:"常用数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用数据库"}},[t._v("#")]),t._v(" 常用数据库")]),t._v(" "),s("p",[t._v("这里列举俩，其它在"),s("a",{attrs:{href:"https://deno.land/x",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1),t._v("自己搜索。")]),t._v(" "),s("h4",{attrs:{id:"mongodb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[t._v("#")]),t._v(" MongoDB")]),t._v(" "),s("p",[t._v("有"),s("a",{attrs:{href:"https://deno.land/x/mongo",target:"_blank",rel:"noopener noreferrer"}},[t._v("deno_mongo"),s("OutboundLink")],1),t._v("，有常用的API。当然，它没有"),s("code",[t._v("mongoose")]),t._v("那么丰富，更复杂的功能可能就需要你来自己造轮子了。")]),t._v(" "),s("h4",{attrs:{id:"redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[t._v("#")]),t._v(" Redis")]),t._v(" "),s("p",[t._v("有"),s("a",{attrs:{href:"https://deno.land/x/redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("deno-redis"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"nodemon"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nodemon"}},[t._v("#")]),t._v(" Nodemon")]),t._v(" "),s("p",[t._v("我们使用"),s("code",[t._v("nodemon")]),t._v("来监控Node.js程序，可以自动重启服务，在开发阶段非常方便。"),s("br"),t._v("\ndeno中替代品为"),s("a",{attrs:{href:"https://deno.land/x/denon",target:"_blank",rel:"noopener noreferrer"}},[t._v("denon"),s("OutboundLink")],1),t._v("，我们需要维护一个scripts.json，起到Node.js中package.json里script命令的作用。")]),t._v(" "),s("p",[t._v("一个简单的样例体会下：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用denon dev启动服务")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scripts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dev")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deno run example/main.ts"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("desc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run example main.ts file"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" net\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" env\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" write\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unstable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lock.json\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" info\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PORT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1000"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cmd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deno bundle example/main.ts example/main.js"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("watch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),s("p",[t._v("现在推荐使用上述官网内置的命令deno task。")]),t._v(" "),s("h3",{attrs:{id:"测试工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试工具"}},[t._v("#")]),t._v(" 测试工具")]),t._v(" "),s("p",[t._v("在Node.js里，我们有jest、Jasmine等库，而deno可以使用官方测试std库测试："),s("a",{attrs:{href:"https://deno.land/std/testing",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://deno.land/std/testing"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" assertStrictEq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://deno.land/std/testing/asserts.ts'")]),t._v("\nDeno"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'My first test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertStrictEq")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("运行测试：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("➜  deno "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n")])])]),s("h3",{attrs:{id:"nvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nvm"}},[t._v("#")]),t._v(" nvm")]),t._v(" "),s("p",[t._v("我们使用nvm来管理Node.js版本，在Deno中有"),s("a",{attrs:{href:"https://deno.land/x/dvm",target:"_blank",rel:"noopener noreferrer"}},[t._v("dvm"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"在docker中运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在docker中运行"}},[t._v("#")]),t._v(" 在docker中运行")]),t._v(" "),s("p",[t._v("Dockerhub 现已提供 Deno 的官方 Docker 镜像。")]),t._v(" "),s("ul",[s("li",[t._v("Alpine Linux: denoland/deno:alpine")]),t._v(" "),s("li",[t._v("Centos: denoland/deno:centos")]),t._v(" "),s("li",[t._v("Debian: denoland/deno:debian（默认）")]),t._v(" "),s("li",[t._v("Distroless: denoland/deno:distroless")]),t._v(" "),s("li",[t._v("Ubuntu: denoland/deno:ubuntu")])]),t._v(" "),s("p",[t._v("要在 "),s("code",[t._v("Docker")]),t._v(" 内部运行 Deno，我们可以创建以下 "),s("code",[t._v("Dockerfile")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("FROM denoland/deno:1.13.2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The port that your application listens to.")]),t._v("\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1993")]),t._v("\n\nWORKDIR /app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Prefer not to run as root.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v(" deno\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Cache the dependencies as a layer (the following two steps are re-run only when deps.ts is modified).")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Ideally cache deps.ts will download and compile _all_ external files used in main.ts.")]),t._v("\nCOPY deps.ts "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nRUN deno cache deps.ts\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# These steps will be re-run upon each file change in your working directory:")]),t._v("\nADD "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Compile the main app so that it doesn't need to be compiled each startup/entry.")]),t._v("\nRUN deno cache main.ts\n\nCMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"run"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--allow-net"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"main.ts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("然后这样使用：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1993")]),t._v(":1993 app\n")])])]),s("p",[t._v("详见"),s("a",{attrs:{href:"https://github.com/denoland/deno_docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("以下是一个我们项目中的样例：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("FROM denoland/deno:alpine-1.30.1\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("\n\nWORKDIR /app\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Prefer not to run as root.")]),t._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-R")]),t._v(" deno /app\nRUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("755")]),t._v(" /app\n\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("USER")]),t._v(" deno\n\nCOPY "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\nENV "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DENO_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("deno-dir\nRUN deno cache --import-map import_map_proxy.json "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unstable")]),t._v(" mod.ts\n\nCMD deno run --allow-net --allow-env --allow-write --allow-read "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--importmap")]),t._v(" import_map_proxy.json "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unstable")]),t._v(" mod.ts\n")])])]),s("p",[t._v("这里设置了"),s("code",[t._v("DENO_DIR")]),t._v("，原因是在前面"),s("code",[t._v("CICD")]),t._v("的流水线中，已经缓存了工程的依赖包在"),s("code",[t._v("deno-dir")]),t._v("目录下，在这里就不必再下载了。")]),t._v(" "),s("p",[t._v("​")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("本文主要是为了科普Deno，介绍了它的优势与缺点，安装使用与常用Node.js库的替代方案。它相较于Node.js，没有历史包袱，所以可以轻装上阵。")]),t._v(" "),s("p",[t._v("但想要替代Node.js成为前端人员的标配，就不是一年两年可以做到的事情了。除非Deno 真的推出了 Node.js 无法复制的强大功能，那才有可能会改变游戏规则。")]),t._v(" "),s("p",[t._v("Deno现在正在努力做的是兼容Node.js的API，降低后者开发者的迁移难度，这样才有可能将Node.js长达十余年的生态继承过来。")]),t._v(" "),s("p",[t._v("虽然Deno没有达到石破天惊的效果，但仍是个优秀的工具，我看好它。希望大家都有兴趣玩一玩。")]),t._v(" "),s("p",[t._v("​"),s("br"),t._v("\n参考：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://juejin.im/post/5ebcabb2e51d454da74185a9#heading-2",target:"_blank",rel:"noopener noreferrer"}},[t._v("20 分钟入门 deno"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://deno.land/manual",target:"_blank",rel:"noopener noreferrer"}},[t._v("Deno手册【官方】"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://deno-tutorial.js.org/articles/translation/from-node-to-deno.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从 Node 到 Deno：探索各大主流库替代方案"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/141832695",target:"_blank",rel:"noopener noreferrer"}},[t._v("了不起的 Deno 入门与实战"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);