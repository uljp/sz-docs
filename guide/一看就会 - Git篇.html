<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>生椰拿铁</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="https://static.uino.cn/uino_favicon_32.ico">
    <meta name="description" content="sz docs">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1a8e0fbc.css" as="style"><link rel="preload" href="/assets/js/app.680f757a.js" as="script"><link rel="preload" href="/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/assets/js/34.051cd83e.js" as="script"><link rel="prefetch" href="/assets/js/10.23033a15.js"><link rel="prefetch" href="/assets/js/11.1159667a.js"><link rel="prefetch" href="/assets/js/12.b7682a80.js"><link rel="prefetch" href="/assets/js/13.b40896ae.js"><link rel="prefetch" href="/assets/js/14.7d6cdd2a.js"><link rel="prefetch" href="/assets/js/15.96809982.js"><link rel="prefetch" href="/assets/js/16.9183fc9e.js"><link rel="prefetch" href="/assets/js/17.ecc2fb02.js"><link rel="prefetch" href="/assets/js/18.cbb699f8.js"><link rel="prefetch" href="/assets/js/19.be221f77.js"><link rel="prefetch" href="/assets/js/20.2607d007.js"><link rel="prefetch" href="/assets/js/21.88cceb8e.js"><link rel="prefetch" href="/assets/js/22.195d0f98.js"><link rel="prefetch" href="/assets/js/23.b8d00998.js"><link rel="prefetch" href="/assets/js/24.11b77b7c.js"><link rel="prefetch" href="/assets/js/25.be5d2349.js"><link rel="prefetch" href="/assets/js/26.1420905b.js"><link rel="prefetch" href="/assets/js/27.45c79ed2.js"><link rel="prefetch" href="/assets/js/28.c163103b.js"><link rel="prefetch" href="/assets/js/29.22812323.js"><link rel="prefetch" href="/assets/js/3.79377ed2.js"><link rel="prefetch" href="/assets/js/30.579adef3.js"><link rel="prefetch" href="/assets/js/31.5b8d686b.js"><link rel="prefetch" href="/assets/js/32.cd1a7df8.js"><link rel="prefetch" href="/assets/js/33.08291efa.js"><link rel="prefetch" href="/assets/js/35.9226c874.js"><link rel="prefetch" href="/assets/js/36.786d1b02.js"><link rel="prefetch" href="/assets/js/37.6c82cb08.js"><link rel="prefetch" href="/assets/js/38.cb3a3a25.js"><link rel="prefetch" href="/assets/js/39.6106e297.js"><link rel="prefetch" href="/assets/js/4.da3ef268.js"><link rel="prefetch" href="/assets/js/40.c6403136.js"><link rel="prefetch" href="/assets/js/41.7426ccdd.js"><link rel="prefetch" href="/assets/js/42.dde98d37.js"><link rel="prefetch" href="/assets/js/43.d71415f0.js"><link rel="prefetch" href="/assets/js/44.6e365644.js"><link rel="prefetch" href="/assets/js/45.2d67f6fc.js"><link rel="prefetch" href="/assets/js/46.85a0827b.js"><link rel="prefetch" href="/assets/js/47.3314ed73.js"><link rel="prefetch" href="/assets/js/48.9cf9a0ad.js"><link rel="prefetch" href="/assets/js/49.1761cc9c.js"><link rel="prefetch" href="/assets/js/5.dac787d8.js"><link rel="prefetch" href="/assets/js/50.6a10f71e.js"><link rel="prefetch" href="/assets/js/51.e2c36d0f.js"><link rel="prefetch" href="/assets/js/52.1bd7b444.js"><link rel="prefetch" href="/assets/js/53.70686b59.js"><link rel="prefetch" href="/assets/js/54.6dde35b4.js"><link rel="prefetch" href="/assets/js/55.b6e40a11.js"><link rel="prefetch" href="/assets/js/56.c3e28e98.js"><link rel="prefetch" href="/assets/js/57.fb1fa78b.js"><link rel="prefetch" href="/assets/js/58.58dbfe64.js"><link rel="prefetch" href="/assets/js/59.27c2ddae.js"><link rel="prefetch" href="/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/assets/js/60.92b7cad7.js"><link rel="prefetch" href="/assets/js/61.990276f0.js"><link rel="prefetch" href="/assets/js/62.e42f2df7.js"><link rel="prefetch" href="/assets/js/63.34f79dc1.js"><link rel="prefetch" href="/assets/js/7.307492ca.js"><link rel="prefetch" href="/assets/js/8.2b132dc4.js"><link rel="prefetch" href="/assets/js/9.3c5a8fdb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1a8e0fbc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">生椰拿铁</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  Config
</a></div><div class="nav-item"><a href="https://v1.vuepress.vuejs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>什么是Deno</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/什么是Deno.html" class="sidebar-link">简介</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>本文包含四部分内容：</p> <ul><li>Linus Torvalds</li> <li>Git 是什么</li> <li>Git add 和 commit 内部实现原理</li> <li>动画解析 Git 命令</li></ul> <hr> <p>先来了解一下是谁创造了Git</p> <h2 id="linus-torvalds"><a href="#linus-torvalds" class="header-anchor">#</a> Linus Torvalds</h2> <p>2005 年，一位 Linux 开发成员写了一个可以连接 BitKeeper 仓库的外挂，因此 BitMover 公司认为他反编译了 BitKeeper。BitMover 决定中止 Linux 免费使用 BitKeeper 的授权。最终 Linux 团队与 BitMover 磋商无果，Torvalds 决定开发自己的版本管理系统。</p> <p><strong>十天后，git 诞生了。</strong></p> <p>是的，没有搞错，就用了10天。<s>开发了一个世界上最大的 交友网站</s>！！</p> <p>这个人就是下面这位</p> <p><img src="https://avatars.githubusercontent.com/u/1024025?v=4" alt="test"></p> <blockquote><p>一辈子就做成了两件事，创造了linux和Git</p></blockquote> <ul><li><p>1991年 linux 0.01 开源</p></li> <li><p>1997 年，《大教堂与集市》第一版发布。书中通过分析 Linux 成功的案例，总结开源开发规律。</p></li> <li><p>2005 年，Git诞生</p></li></ul> <blockquote><p>Talk is cheap. Show me the code.</p></blockquote> <p>这句话就是出自Linus Torvards，他还有很多经典的语录，会在本篇文章结尾给出。</p> <p>同时，他也在用实际行动告诉我们。下图是他最近一年在github上的代码提交，几乎每天都在提交代码。</p> <p><img src="https://pan.udolphin.com/files/image/2021/8/4b7a35b57ffeb3671e36085a816d231d.png" alt="image.png"></p> <p>Q：Git是用什么语言写的？</p> <p>A：C语言</p> <hr> <p>介绍完作者，现在进入正文部分。</p> <h2 id="git是什么"><a href="#git是什么" class="header-anchor">#</a> Git是什么</h2> <blockquote><p>Git is a fast, scalable, distributed revision control system with an unusually rich command set that provides both high-level operations and full access to internals.</p></blockquote> <p>上面这句话源自git仓库readme文件，包含了4个信息：</p> <ul><li><p>fast：快速的，一次拉取获取到远端所有分支，大部分命令可以在本地操作</p></li> <li><p>scalable：可扩展的，本地切出多分支，推送之前这些分支可以不需要和远端交互</p></li> <li><p>distribution revision control system：分布式版本控制系统</p></li> <li><p>unusually rich command set：非常丰富的命令集</p></li></ul> <hr> <p>Q：git有多少个commands？</p> <p>A：142 个 commands， 常用10个</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> <span class="token builtin class-name">help</span> -a<span class="token operator">|</span><span class="token function">grep</span> <span class="token string">&quot;^  &quot;</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre></div><p>但是在 Linus 看来，git只不过是 <code>A stupid content tracker</code> ，这一点在分析git内部实现原理的时候会深有其感</p> <h3 id="什么是版本控制"><a href="#什么是版本控制" class="header-anchor">#</a> 什么是版本控制？</h3> <blockquote><p>一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。</p></blockquote> <p>分为三种类型：</p> <ul><li>本地版本控制系统</li> <li>集中式版本控制系统</li> <li>分布式版本控制系统</li></ul> <h5 id="本地版本控制系统"><a href="#本地版本控制系统" class="header-anchor">#</a> 本地版本控制系统</h5> <p>​	同系统上开发协同</p> <p>​	eg：写论文的时候，只要你不是论文一把过，都会改好几次。对于每个版本的论文，许多人习惯用复制整个项目目录的方式来保存不同的版本，或许还会改名加上备份时间以示区别。 这么做唯一的好处就是简单，但是特别容易犯错。 有时候会混淆所在的工作目录，一不小心会写错文件或者覆盖意想外的文件。</p> <p><code>缺点</code>：有时候会混淆所在的工作目录，一不小心会写错文件或者覆盖意想外的文件。</p> <p><img src="https://git-scm.com/book/en/v2/images/local.png" alt="本地版本控制系统"></p> <h5 id="集中式版本控制系统-svn"><a href="#集中式版本控制系统-svn" class="header-anchor">#</a> 集中式版本控制系统 SVN</h5> <p>不同系统上的开发者协同工作</p> <p>有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。</p> <p><code>优点</code>：管理员也可以轻松掌控每个开发者的权限</p> <p><code>缺点</code>：中央服务器的单点故障，如果宕机一小时，那么在这一小时内，谁都无法提交更新，也就无法协同工作</p> <p><img src="https://git-scm.com/book/en/v2/images/centralized.png" alt="集中式版本控制系统"></p> <h5 id="分布式版本控制系统-git"><a href="#分布式版本控制系统-git" class="header-anchor">#</a> 分布式版本控制系统 Git</h5> <p>​	每一次的克隆操作，实际上都是一次对代码仓库的完整备份</p> <p>​	eg：每台机器都可以独立作为一个服务器</p> <p><img src="https://git-scm.com/book/en/v2/images/distributed.png" alt="分布式版本控制"></p> <p>既然Git这么强，为什么Google 和 Facebook 不用 git 管理源码？</p> <p>在美版知乎网站 StackOverflow 上曾经有一个问题《<a href="https://link.zhihu.com/?target=https%3A//stackoverflow.com/questions/871/why-is-git-better-than-subversion" target="_blank" rel="noopener noreferrer">Why is Git better than Subversion?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>》，被采纳的高赞回答是这样说的：</p> <blockquote><p>Git is not better than Subversion. But is also not worse. <strong>It's different</strong>.</p></blockquote> <h2 id="git-内部原理"><a href="#git-内部原理" class="header-anchor">#</a> Git 内部原理</h2> <p><img src="https://pic2.zhimg.com/v2-3bc9d5f2c49a713c776e69676d7d56c5_r.jpg" alt="git仓库结构"></p> <hr> <ul><li><p>Workspace：工作区</p> <p>实际看到的目录和目录里的内容</p></li> <li><p>Index / Staged： 暂存区</p> <p>工作区中有一个隐藏目录 .git   ---&gt;  git的版本库。这个版本库里包含：</p> <ul><li><p>index文件，staged</p></li> <li><p>git自动创建的master分支</p></li> <li><p>指向master的第一个指针Head</p></li></ul></li> <li><p>Repository： 本地仓库</p></li> <li><p>Remote： 远程仓库</p></li></ul> <p>这里只介绍add和commit的过程</p> <p>一个git仓库.git 目录下会包含以下内容</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">ls</span> <span class="token parameter variable">-F1</span>

<span class="token comment"># 得到以下内容</span>
config
description
HEAD
hooks/
info/
objects/
refs/
</code></pre></div><ul><li><code>config</code> 文件包含项目特有的配置选项。</li> <li><code>description</code> 文件仅供 GitWeb 程序使用，我们无需关心</li> <li><code>info</code> 目录包含一个全局性排除（global exclude）文件， 用以放置那些不希望被记录在 <code>.gitignore</code> 文件中的忽略模式（ignored patterns）。</li> <li><code>hooks</code> 目录包含客户端或服务端的钩子脚本（hook scripts）cat</li> <li><code>HEAD</code> 文件：<code>HEAD</code> 文件指向目前被检出的分支</li> <li>（尚待创建的）<code>index</code> 文件：<code>index</code> 文件保存暂存区信息</li> <li><code>objects</code> 目录：存储所有数据内容</li> <li><code>refs</code> 目录：存储指向数据（分支、远程仓库和标签等）的提交对象的指针</li></ul> <h3 id="创建一个新的文件夹"><a href="#创建一个新的文件夹" class="header-anchor">#</a> 创建一个新的文件夹</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 创建 project 文件夹</span>
$ <span class="token function">mkdir</span> project
<span class="token comment"># 打开 project 文件夹</span>
$ <span class="token builtin class-name">cd</span> project
<span class="token comment"># 初始化</span>
$ <span class="token function">git</span> init
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看git目录树结构</span>
$ tree .git/

.git
├── HEAD
├── config
├── description
├── hooks
│   ├── applypatch-msg.sample
│   ├── commit-msg.sample
│   ├── fsmonitor-watchman.sample
│   ├── post-update.sample
│   ├── pre-applypatch.sample
│   ├── pre-commit.sample
│   ├── pre-merge-commit.sample
│   ├── pre-push.sample
│   ├── pre-rebase.sample
│   ├── pre-receive.sample
│   ├── prepare-commit-msg.sample
│   ├── push-to-checkout.sample
│   └── update.sample
├── info
│   └── exclude
├── objects
│   ├── info
│   └── pack
└── refs
    ├── heads
    └── tags
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 创建一个新文件</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">'hello demo'</span> <span class="token operator">&gt;</span> demo1.txt
$ <span class="token function">ls</span> <span class="token parameter variable">-al</span>

drwxr-xr-x   <span class="token number">4</span> panlei  staff  <span class="token number">128</span> Aug  <span class="token number">4</span> <span class="token number">22</span>:27 <span class="token builtin class-name">.</span>
drwxr-xr-x   <span class="token number">6</span> panlei  staff  <span class="token number">192</span> Aug  <span class="token number">4</span> <span class="token number">22</span>:24 <span class="token punctuation">..</span>
drwxr-xr-x  <span class="token number">12</span> panlei  staff  <span class="token number">384</span> Aug  <span class="token number">4</span> <span class="token number">22</span>:46 .git
-rw-r--r--   <span class="token number">1</span> panlei  staff   <span class="token number">11</span> Aug  <span class="token number">4</span> <span class="token number">22</span>:27 demo1.txt
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 使用 git add命令</span>
$ <span class="token function">git</span> <span class="token function">add</span> demo1.txt
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 这个时候再查看.git目录下的内容</span>
$ tree .git

.git
├── HEAD
├── config
├── description
├── hooks
│   ├── applypatch-msg.sample
│   ├── commit-msg.sample
│   ├── fsmonitor-watchman.sample
│   ├── post-update.sample
│   ├── pre-applypatch.sample
│   ├── pre-commit.sample
│   ├── pre-merge-commit.sample
│   ├── pre-push.sample
│   ├── pre-rebase.sample
│   ├── pre-receive.sample
│   ├── prepare-commit-msg.sample
│   ├── push-to-checkout.sample
│   └── update.sample
├── index
├── info
│   └── exclude
├── objects
│   ├── <span class="token number">90</span>
│   │   └── dd573a597ea266ffd31bb0c2feff9eabdafdac
│   ├── info
│   └── pack
└── refs
    ├── heads
    └── tags
</code></pre></div><p>发现在目录下多出了一个 hash 值，这个hash值是什么呢？</p> <p>会不会是文件内容呢，毕竟前面有说到 git 是 content tracker。打印出来看一下</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'hello demo'</span> <span class="token operator">|</span> <span class="token function">git</span> hash-object <span class="token parameter variable">--stdin</span>

90dd573a597ea266ffd31bb0c2feff9eabdafdac
</code></pre></div><p>真的就对应着文件内容。</p> <h4 id="为什么objects里生成的hash一分为二了"><a href="#为什么objects里生成的hash一分为二了" class="header-anchor">#</a> 为什么objects里生成的hash一分为二了？</h4> <p>A：40 个字符串里有2个拎出来做文件夹名，38位做文件名</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看新文件的hash 值</span>
<span class="token builtin class-name">echo</span> <span class="token string">'hello demo'</span> <span class="token operator">|</span> <span class="token function">git</span> hash-object <span class="token parameter variable">--stdin</span>

<span class="token comment"># -w</span>
<span class="token comment"># Actually write the object into the object database.</span>

<span class="token comment"># --stdin</span>
<span class="token comment"># Read the object from standard input instead of from a file.</span>
</code></pre></div><blockquote><p><strong>SHA-1</strong></p> <p>Secure Hash Algorithm 1 安全散列算法1</p> <p>散列值通常的呈现形式为40个<a href="https://zh.wikipedia.org/wiki/%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6" target="_blank" rel="noopener noreferrer">十六进制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>数。</p> <p>05年密码分析人员发现了对SHA-1的有效攻击方法，这表明该算法可能不够安全，不能继续使用</p></blockquote> <h5 id="a1-trie-踹-树"><a href="#a1-trie-踹-树" class="header-anchor">#</a> A1 - trie（踹） 树</h5> <blockquote><p>单词查找树，是一种树形结构，用于保存大量的字符串</p></blockquote> <p>优点是：检索快，利用字符串的公共前缀来节约存储空间。</p> <h5 id="a2-文件数量限制"><a href="#a2-文件数量限制" class="header-anchor">#</a> A2 - 文件数量限制</h5> <p>单目录下的文件在某些文件系统是有限制的，通过这种方式缓解这个问题</p> <p>Q2：一般来说，存文件会存时间戳，这里没有记录时间戳，文件内容和时间戳都丢失了吗？</p> <p>A：Git hash的是content，不在乎state是什么。但是Git还是要存这些文件state的，存在stage files里面</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看 git stage 里的内容</span>
<span class="token comment"># 显示有关索引和工作树中文件的信息</span>
$ <span class="token function">git</span> ls-files <span class="token parameter variable">--stage</span>

<span class="token number">100644</span> 90dd573a597ea266ffd31bb0c2feff9eabdafdac <span class="token number">0</span>	demo1.txt
</code></pre></div><p>Q：100644 是什么意思？</p> <p>A：前三位代表了文件类型。100 是普通文件</p> <hr> <div class="language- extra-class"><pre><code> Linux 系统中采用三位十进制数表示权限，如0755， 0644.
 
    A - 0， 十进制
    B - 用户
    C - 组用户
    D - 其他用户

    ---  -&gt; 0  (no execute , no write ,no read)
    --x  -&gt; 1  execute, (no write, no read)
    -w-  -&gt; 2  write 
    -wx  -&gt; 3  write, execute
    r--  -&gt; 4  read
    r-x  -&gt; 5  read, execute
    rw-  -&gt; 6  read, write
    rwx  -&gt; 7  read, write , execute


 一般赋予目录0755权限，文件0644权限
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 打印生成的文件里的内容, 只要给hash值前几位</span>
$ <span class="token function">git</span> cat-file <span class="token parameter variable">-p</span> 90dd

hello demo
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 打印文件的类型</span>
$ <span class="token function">git</span> cat-file <span class="token parameter variable">-t</span> 90dd

blob
</code></pre></div><p>从这里可以发现，文件内容是以blob（Binary large object）存储的</p> <h3 id="git-add-做了什么事情"><a href="#git-add-做了什么事情" class="header-anchor">#</a> Git add 做了什么事情</h3> <p>1、把这个文件写成hash，文件内容是以二进制形式存储为一个Blob, 这个Blob file的名字是文件内容的hash值。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">echo</span> <span class="token string">'hello demo'</span> <span class="token operator">|</span> <span class="token function">git</span> hash-object <span class="token parameter variable">-w</span> <span class="token parameter variable">--stdin</span>

90dd573a597ea266ffd31bb0c2feff9eabdafdac
</code></pre></div><p>2、update-index，即放进stage area</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> update-index <span class="token parameter variable">--add</span> <span class="token parameter variable">--cacheinfo</span>

<span class="token number">10064</span> df33e3965574decdfb364081521647a848324280 hello.txt
</code></pre></div><p>git add 只会对文件做hash，不关心目录。没有commit之前，目录存在index里</p> <h3 id="git-commit-做了什么事情"><a href="#git-commit-做了什么事情" class="header-anchor">#</a> Git commit 做了什么事情</h3> <p>Q：执行一次 commit 新增了几个文件?</p> <div class="language-bash extra-class"><pre class="language-bash"><code>.git
├── COMMIT_EDITMSG
├── HEAD
├── config
├── description
├── hooks
│   ├── applypatch-msg.sample
│   ├── commit-msg.sample
│   ├── fsmonitor-watchman.sample
│   ├── post-update.sample
│   ├── pre-applypatch.sample
│   ├── pre-commit.sample
│   ├── pre-merge-commit.sample
│   ├── pre-push.sample
│   ├── pre-rebase.sample
│   ├── pre-receive.sample
│   ├── prepare-commit-msg.sample
│   ├── push-to-checkout.sample
│   └── update.sample
├── index
├── info
│   └── exclude
├── logs
│   ├── HEAD
│   └── refs
│       └── heads
│           └── master
├── objects
│   ├── <span class="token number">83</span>
│   │   └── 250377d70e516ddcd4b0257868c949b04a5562
│   ├── <span class="token number">90</span>
│   │   └── dd573a597ea266ffd31bb0c2feff9eabdafdac
│   ├── <span class="token number">93</span>
│   │   └── 0e4c9864e59861622b5c3252000abff81b0d7b
│   ├── info
│   └── pack
└── refs
    ├── heads
    │   └── master
    └── tags

</code></pre></div><p>A：生成了两个文件</p> <p>第一个文件里是一个commit object，这里面带有commit-message、author、tree</p> <blockquote><p>tree 是目录，根结点</p></blockquote> <p>第二个文件是一个tree</p> <p>第三个文件也就是刚才add的那个Blob文件</p> <h4 id="git-log"><a href="#git-log" class="header-anchor">#</a> Git log</h4> <p>Q：git log的时候怎么知道从哪个commit开始看？</p> <p>A：refs</p> <p>最早创建HEAD的时候，里面有内容，指向refs/heads/master，里面是一个hash，hash指向commit</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> .git/HEAD
ref: refs/heads/master
$ <span class="token function">cat</span> .git/refs/heads/master
sdfafsad2ewadsad -<span class="token operator">&gt;</span> <span class="token builtin class-name">hash</span>
</code></pre></div><p>Q：git 文件越来越大怎么办？</p> <p>A：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 删除数据库中不需要的文件和将其他文件打包成一种更有效的格式。</span>
<span class="token comment"># garbage collection</span>
$ <span class="token function">git</span> gc
</code></pre></div><h2 id="动画解析-git-命令"><a href="#动画解析-git-命令" class="header-anchor">#</a> 动画解析 Git 命令</h2> <p>动画的形式能帮助更好地学习和理解git。来自 <a href="https://dev.to/lydiahallie/cs-visualized-useful-git-commands-37p1" target="_blank" rel="noopener noreferrer">Lydia Hallie<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>平常的练习可以通过 <a href="https://learngitbranching.js.org/" target="_blank" rel="noopener noreferrer">动画学习Git网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来学习</p> <h3 id="git-merge"><a href="#git-merge" class="header-anchor">#</a> git merge</h3> <p>将两个或多个开发历史连接在一起</p> <h4 id="fast-forward"><a href="#fast-forward" class="header-anchor">#</a> fast forward</h4> <p>Git 默认使用 fast-forward 这种类型来处理分支合并，当我们成功合并后，不会产生任何提交记录</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--cT4TSe48--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/894znjv4oo9agqiz4dql.gif" alt="fast forward"></p> <h4 id="no-fast-forward"><a href="#no-fast-forward" class="header-anchor">#</a> no fast forward</h4> <p>在合并分支命令加入 <code>--no-ff</code> 后缀的方式运行时，便会生成一个新的提交记录（推荐多人协作开发使用）</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--zRZ0x2Vc--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/rf1o2b6eduboqwkigg3w.gif" alt="no fast forward"></p> <p>合并产生冲突的时候可以编辑处理冲突后，再走正常的提交流程</p> <p><img src="https://pic2.zhimg.com/v2-541bb7ef46a76b0be1f055427e7e94e1_b.webp" alt="conflict"></p> <h3 id="git-rebase"><a href="#git-rebase" class="header-anchor">#</a> git rebase</h3> <p>改变当前分支的基座节点</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--EIY4OOcE--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/dwyukhq8yj2xliq4i50e.gif" alt="git rebase"></p> <p>在<code>rebase</code>的过程中，也许会出现冲突(conflict)。在这种情况，Git会停止<code>rebase</code>并会让你去解决冲突；在解决完冲突后，用”<code>git add</code>“命令去更新这些内容的索引(index), 然后，你无需执行 <code>git commit</code>,只要执行:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> rebase <span class="token parameter variable">--continue</span>
</code></pre></div><p>这样git会继续应用(apply)余下的补丁。</p> <p>在任何时候，可以用<code>--abort</code>参数来终止<code>rebase</code>的操作，并且”<code>mywork</code>“ 分支会回到<code>rebase</code>开始前的状态。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">git</span> rebase <span class="token parameter variable">--abort</span>
</code></pre></div><h4 id="interactive-rebase"><a href="#interactive-rebase" class="header-anchor">#</a> Interactive Rebase</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>$ $ <span class="token function">git</span> rebase <span class="token parameter variable">-i</span> ee9ee598ea2a4bece9b23
</code></pre></div><p>交互式变基，可以在rebase过程中对改变的commit进行操作</p> <ul><li><p>reword: Change the commit message</p> <p>保留该commit，但我需要修改该commit的注释（缩写:r）</p></li> <li><p>edit: Amend this commit</p> <p>保留该commit, 但我要停下来修改该提交(不仅仅修改注释)（缩写:e）</p></li> <li><p>squash: Meld commit into the previous commit</p> <p>将该commit和前一个commit合并（缩写:s）</p></li> <li><p>fixup: Meld commit into the previous commit, without keeping the commit's log message</p> <p>将该commit和前一个commit合并，但我不要保留该提交的注释信息（缩写:f）</p></li> <li><p>exec: Run a command on each commit we want to rebase</p> <p>执行shell命令（缩写:x）</p></li> <li><p>drop: Remove the commit</p> <p>我要丢弃该commit（缩写:d）</p></li></ul> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--P6jr7igd--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/msofpv7k6rcmpaaefscm.gif" alt="git rebase"></p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--VSQt4g1V--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/bc1r460xx1i0blu0lnnm.gif" alt="gi rebase"></p> <h3 id="git-reset"><a href="#git-reset" class="header-anchor">#</a> git reset</h3> <h4 id="git-reset-mixed"><a href="#git-reset-mixed" class="header-anchor">#</a> git reset --mixed</h4> <p>默认mixed</p> <p>①移动本地库HEAD指针</p> <p>②重置暂存区</p> <p>意思就是，回滚后，不仅移动了本地库的指针，同时暂存区的东西也没了，意思就是你上次添加到暂存区的文件没了-</p> <h4 id="git-reset-soft"><a href="#git-reset-soft" class="header-anchor">#</a> git reset --soft</h4> <p>①移动本地库HEAD指针</p> <p>意思就是，回滚后，仅仅是把本地库的指针移动了，而暂存区和你本地的代码是没有做任何改变的。而你上次改动已提交committed到本地库的代码显示是绿色即未提交</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s---GveiZe---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/je5240aqa5uw9d8j3ibb.gif" alt="git reset --soft"></p> <h4 id="git-reset-hard"><a href="#git-reset-hard" class="header-anchor">#</a> git reset --hard</h4> <p>①移动本地库HEAD指针</p> <p>②重置暂存区</p> <p>③重置工作区</p> <p>意思就是，回滚后，本地代码就是你回退版本的代码</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--GqjwnYkF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/hlh0kowt3hov1xhcku38.gif" alt="git reset --hard"></p> <h3 id="git-revert"><a href="#git-revert" class="header-anchor">#</a> git revert</h3> <p>git revert 后多出一条commit ，提醒同事，这里有回撤操作，只能撤回最新的提交</p> <p>git reset 直接把之前 commit 删掉，非git reset --hard的操作是不会删掉修改代码，如果远程已经有之前代码，需要强推 git push origin 【分支名】 --force</p> <p>注意： 慎用revert ！！！</p> <p>多人协同开发时，get revert 会影响到其他人的代码</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--eckmvr2M--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/3kkd2ahn41zixs12xgpf.gif" alt="git revert"></p> <h3 id="git-cherry-pick"><a href="#git-cherry-pick" class="header-anchor">#</a> git cherry-pick</h3> <p>不是合并内容，只是想把某次提交摘取过来</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> log <span class="token parameter variable">--oneline</span> <span class="token parameter variable">--graph</span> <span class="token parameter variable">--all</span>
</code></pre></div><p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--9vWP_K4S--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/2dkjx4yeaal10xyvj29v.gif" alt="git cherry-pick"></p> <h3 id="git-fetch"><a href="#git-fetch" class="header-anchor">#</a> git fetch</h3> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--38PuARw2--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/bulx1voegfji4vwgndh4.gif" alt="git fetch"></p> <h3 id="git-pull"><a href="#git-pull" class="header-anchor">#</a> git pull</h3> <p>虽然 <code>git fetch</code>对于获取分支的远程信息非常有用，但我们也可以执行  <code>git pull</code>。<code>git pull</code>实际上是两个命令合二为一： <code>git fetch</code>和 a <code>git merge</code>。当我们从原点拉取更改时，我们首先像使用 <code>git pull</code>一样获取所有数据<code>git fetch</code>，之后最新的更改会自动合并到本地分支中。</p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s---X5AXldj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/zifpnl1h6a4tk4qdc9sy.gif" alt="git pull"></p> <h3 id="git-reflog"><a href="#git-reflog" class="header-anchor">#</a> git reflog</h3> <p><code>功能</code>：管理 reflog 信息、</p> <p>git reflog 可以查看所有分支的所有操作记录（包括commit和reset的操作、已被删除的commit记录）
git log则不能察看已经删除了的commit记录</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> reflog <span class="token parameter variable">-3</span>
$ <span class="token function">git</span> reflog <span class="token parameter variable">-all</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> log <span class="token parameter variable">--oneline</span> <span class="token parameter variable">-6</span>
</code></pre></div><p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--MMUdOS0P--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/1aqek1py1knwl926ele7.gif" alt="git reflog"></p> <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--A1UMM2AH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/9z9rhtbw7mrigp0miijz.gif" alt="git reflog"></p> <h3 id="git-stash"><a href="#git-stash" class="header-anchor">#</a> git stash</h3> <p>这个就是把当前开发内容藏起来</p> <p>比如，现在正在开发一小块新功能（还没写完），突然线上有bug要紧急修复。这时候需要切换分支来修复，可以考虑使用 <code>git stash</code> 命令先藏起来。等到修复完bug之后再切回来。然后使用<code>git stash pop</code>将刚才没开发完的继续开发</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 两种方式去隐藏</span>
<span class="token comment"># 1、</span>
$ <span class="token function">git</span> stash pop
<span class="token comment"># 2、</span>
$ <span class="token function">git</span> stash apply stash@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="linus-torvalds-语录"><a href="#linus-torvalds-语录" class="header-anchor">#</a> Linus Torvalds 语录</h2> <p>这个可爱又暴脾气的天才，在<a href="https://en.wikiquote.org/wiki/Linus_Torvalds" target="_blank" rel="noopener noreferrer">wikiquote<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上收录了他的很多语录 。这里只摘取一小部分。</p> <blockquote><p>Talk is cheap. Show me the code.</p></blockquote> <blockquote><p>If you still don’t like it, that’s OK: that’s why I’m boss. I simply know better than you do.</p></blockquote> <blockquote><p>Nobody actually creates perfect code the first time around, except me. But there’s only one of me.</p></blockquote> <blockquote><p>Really, I’m not out to destroy Microsoft. That will just be a completely unintentional side effect.</p></blockquote> <blockquote><p>Real quality means making sure that people are proud of the code they write, that they’re involved and taking it personally.</p></blockquote> <blockquote><p>Standards are paper. I use paper to wipe my butt every day. That’s how much that paper is worth.</p></blockquote> <blockquote><p>“Regression testing”? What’s that? If it compiles, it is good; if it boots up, it is perfect.</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.680f757a.js" defer></script><script src="/assets/js/2.733019b2.js" defer></script><script src="/assets/js/34.051cd83e.js" defer></script>
  </body>
</html>
